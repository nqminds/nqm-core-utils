!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("mongo-parse")):"function"==typeof define&&define.amd?define("nqm-core-utils",["_","mongo-parse"],t):"object"==typeof exports?exports["nqm-core-utils"]=t(require("lodash"),require("mongo-parse")):e["nqm-core-utils"]=t(e._,e["mongo-parse"])}(this,function(e,t){return function(e){function t(o){if(a[o])return a[o].exports;var r=a[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var a={};return t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={readAccess:"r",writeAccess:"w",executeAccess:"x",publicRWShareMode:"pw",publicROShareMode:"pr",trustedShareMode:"tr",resourceEventType:"Resource",accountEventType:"Account",mongooseTypes:{string:1,number:1,date:1,boolean:1},rootGroupResourceType:"rootGroup",schemaResourceType:"schema",datasetResourceType:"dataset",visualisationResourceType:"visualisation",groupResourceType:"resourceGroup",rawFileResourceType:"rawFile",vocabularyResourceType:"vocabulary",widgetVisualisationResourceType:"widgetVisualisation",timeSeriesVisualisationResourceType:"timeSeriesVisualisation",mapVisualisationResourceType:"mapVisualisation",statusVisualisationResourceType:"statusVisualisation",databotBaseType:"databot",databotResourceType:"databotDefinition",databotInstancesResourceType:"databotInstances",databotInstanceOutputResourceType:"databotInstanceOutput",databotProcessesResourceType:"databotProcesses",activeDatabotHostsResourceType:"activeDatabotHosts",databotHostResourceType:"databotHost",databotGroupResourceType:"databotGroup",databotHostGroupResourceType:"databotHostGroup",databotControllerResourceType:"databotController",datasetFilterResourceType:"datasetFilter",applicationBaseType:"applicationBase",applicationResourceType:"application",applicationGroupResourceType:"applicationGroup",applicationDataGroupResourceType:"applicationDataGroup",scratchGroupResourceType:"scratchGroup",rootResourceGroupResourceType:"rootResourceGroup",geojsonResourceType:"geojson",userAccountType:"user",tokenAccountType:"token",hostAccountType:"host",applicationAccountType:"application",schemasResourceId:"__schemas__",vocabularyResourceId:"__vocab__",npmDatabotType:"npm",inlineDatabotType:"script",zipDatabotType:"zip",githubDatabotType:"github",urlDatabotType:"url",browserHostType:"browser",serverHostType:"server",databotInstancesResourceId:"__databotInstances__",databotInstanceOutputResourceId:"__databotInstanceOutput__",databotProcessesResourceId:"__databotProcesses__",activeDatabotHostsResourceId:"__activeDatabotHosts__",unallocatedDatabotStatus:"unallocated",pendingDatabotStatus:"pending",installingDatabotStatus:"installing",partRunningDatabotStatus:"partRunning",runningDatabotStatus:"running",pausedDatabotStatus:"paused",stoppingDatabotStatus:"stopping",completeDatabotStatus:"complete",errorDatabotStatus:"error",immediateDatabotInstanceRunMode:"run-now",alwaysDatabotInstanceRunMode:"run-always",scheduledDatabotInstanceRunMode:"scheduled",datasetImportDatabot:"__datasetImport__",datasetCopyDatabot:"__datasetCopy__",onlineHostStatus:"online",offlineHostStatus:"offline",idleHostStatus:"idle",busyHostStatus:"busy",errorHostStatus:"error",resourceVocabularyId:"ResourceId",datasetVocabularyId:"DatasetId",folderVocabularyId:"FolderId",rawFileVocabularyId:"RawFileId",visualisationVocabularyId:"VisualisationId",schemaVocabularyId:"SchemaId",databotDefinitionVocabularyId:"DatabotDefinitionId",urlVocabularyId:"Url",builtIndexStatus:"built",pendingIndexStatus:"pending",suspendingIndexStatus:"suspending",suspendedIndexStatus:"suspended",errorIndexStatus:"error",googleAuthService:"oauth:google",localAuthService:"local",guestAccount:"...guest...",maxTimestamp:864e13,datasetStorePrefix:"dataset.",rootFolderPrefix:"r.",rootFolderName:"root",scratchFolderPrefix:"s.",scratchFolderName:"scratch",scratchFolderAlias:"__scratch__",resourceFolderPrefix:"rs.",resourceFolderName:"resources",applicationFolderPrefix:"a.",applicationFolderName:"applications",applicationDataFolderPrefix:"ad.",applicationDataFolderName:"application data",databotFolderPrefix:"db.",databotFolderName:"databots",databotHostFolderPrefix:"dh.",databotHostFolderName:"databot hosts",identityFilterPlaceholder:"@@_identity_@@"},e.exports=t.default},function(t,a){t.exports=e},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(){var e=console.log;console.log=function(){e.apply(this,arguments)}}(),t.default=console.log,e.exports=t.default},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(2),s=o(r),n=a(10),u=o(n),i=a(1),c=o(i),d=function(e,t){var a={};return c.default.forEach(e,function(e){var o=e.asc||e.desc,r=u.default.DotNotationPointers(t,o);0===r.length||void 0===r[0].val?(0,s.default)("no key data for field '%s' in %j",o,t):a[o]=r[0].val}),a};t.default=d,e.exports=t.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a(0),r=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(e){return e&&(e.status===r.default.runningDatabotStatus||e.status===r.default.installingDatabotStatus||e.status===r.default.partRunningDatabotStatus||e.status===r.default.pausedDatabotStatus)};t.default={isDatabotInstanceRunning:s},e.exports=t.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e,o){if(Object(e)!==e)a[o]=e;else if(Array.isArray(e)){for(var r=e.length,s=0;s<r;s++)t(e[s],o+"."+s);0===r&&(a[o]=[])}else{var n=!0;for(var u in e)n=!1,t(e[u],o?o+"."+u:u);n&&o&&(a[o]={})}}var a={};return t(e,""),a};t.default=o,e.exports=t.default},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(0),s=o(r),n=a(1),u=o(n),i=function(e,t){return e.schemaDefinition?e.schemaDefinition.id===t||e.schemaDefinition.basedOn&&e.schemaDefinition.basedOn.indexOf(t)>=0:e.baseType===t},c=function(e){var t=void 0;switch(e){case s.default.groupResourceType:t="folder";break;case s.default.rawFileResourceType:t="raw file";break;case s.default.widgetVisualisationResourceType:t="widget visualisation";break;case s.default.timeSeriesVisualisationResourceType:t="time series visualisation";break;case s.default.mapVisualisationResourceType:t="map visualisation";break;case s.default.statusVisualisationResourceType:t="status visualisation";break;case s.default.scheduledTasksResourceType:t="scheduled tasks";break;case s.default.processHostsResourceType:t="process hosts";break;default:t=e}return t},d=function(e){var t=void 0;switch(e){case s.default.publicRWShareMode:t="public view and edit";break;case s.default.publicROShareMode:t="public view, trusted edit";break;case s.default.trustedShareMode:t="trusted only";break;default:t="!!unknown!!"}return t},l=function(e,t){var a={};return u.default.forEach(e.schemaDefinition.uniqueIndex,function(e){var o=e.asc||e.desc;a[o]=t[o]}),a};t.default={getResourceTypeText:c,getShareModeText:d,isResourceType:i,primaryKeyFromFlattened:l},e.exports=t.default},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=a(1),n=o(s),u=a(2),i=o(u),c=a(0),d=o(c),l=["_id","prototype","emit","on","once","listeners","removeListener","collection","db","errors","init","isModified","isNew","get","modelName","save","schema","set","toObject","validate","remove","_pres","_posts"],p=function(e,t){var a=[];return Array.isArray(e)?n.default.forEach(e,function(e){"string"==typeof e?a.push({asc:e}):e.asc||e.desc?a.push(e):t.push("invalid index spec: "+JSON.stringify(e))}):"object"===(void 0===e?"undefined":r(e))&&n.default.forEach(e,function(e,t){-1===e?a.push({desc:t}):a.push({asc:t})}),a},f=function(e,t){var a=void 0;return e=e.toLowerCase(),d.default.mongooseTypes[e]?a=e:t.push("invalid base type: "+e),a},y=function e(t,a){return"object"===(void 0===t?"undefined":r(t))?(n.default.forEach(t,function(o,s){"__tdxType"===s?t[s]=[].concat(o):"__tdxRequired"===s||"__tdxDefault"===s||"__tdxDescription"===s||(Array.isArray(o)?1===o.length?o[0]=e(o[0],a):t[s]=[]:"object"===(void 0===o?"undefined":r(o))?t[s]=e(o,a):"type"===s&&"string"==typeof o?(t.__tdxType=[f(o,a)],delete t.type):"string"==typeof o?t[s]={__tdxType:[f(o,a)]}:a.push("invalid schema definition, unexpected: "+t))}),t):"string"==typeof t?{__tdxType:[f(t,a)]}:void a.push("invalid schema definition, unexpected: "+t)},b=function(e,t){var a=void 0;return e=e.toLowerCase(),d.default.mongooseTypes[e]?a=n.default.capitalize(e):t.push("invalid base type: "+e),a},_=function e(t,a){return a=a||[],n.default.each(t,function(o,s){l.indexOf(s)>=0?((0,i.default)("invalid field name (reserved): %s",s),a.push("invalid field name (reserved): "+s)):"__tdxRequired"===s?(t.required=t.__tdxRequired,delete t.__tdxRequired):"__tdxDefault"===s?(t.default=t.__tdxDefault,delete t.__tdxDefault):"__tdxDescription"===s?delete t.__tdxDescription:"__tdxType"===s?o?(o=[].concat(o),delete t.__tdxType,t.type=o[0].toLowerCase(),"object"===t.type?t={}:"array"===t.type?t=[]:t.type=b(t.type,a)):((0,i.default)("unexpected __tdxType value: %j",o),a.push("missing __tdxType")):Array.isArray(o)?o.length>1?a.push("invalid array type specification for key: "+s):o.length>0&&("string"==typeof o[0]?t[s]={type:b(o[0],a)}:t[s]=[e(o[0],a)]):"object"===(void 0===o?"undefined":r(o))?t[s]=e(o,a):"string"!=typeof o?((0,i.default)("invalid schema definition - unexpected type for key '"+s+"' : "+(void 0===o?"undefined":r(o))),delete t[s]):t[s]={type:b(o,a)}}),t},h=function(e,t){var a=t.uniqueIndex,o=t.nonUniqueIndexes,r=[];n.default.forEach(o,function(e){if(e.length>0){var t={};n.default.forEach(e,function(e){t[e.asc||e.desc]=e.asc?1:-1}),r.push(t)}}),(0,i.default)("translated non unique indexes for %s from %j to %j",e,o,r);var s={};n.default.forEach(a,function(e){s[e.asc||e.desc]=e.asc?1:-1}),(0,i.default)("translated primary index for %s from %j to %j",e,a,s),(0,i.default)("transforming schema for %s: %j",t.id,t.dataSchema);var u=[],c=_(t.dataSchema,u);if(u.length)throw new Error("invalid mongoose schema: "+u.join(","));return(0,i.default)("schema transformed to %j",c),{schema:c,uniqueIndex:s,nonUniqueIndexes:r}};t.default={definitionToMongoose:h,schemaToMongoose:function(e,t){return _(n.default.cloneDeep(e),t)},schemaToTDX:function(e,t){return y(n.default.cloneDeep(e),t)},indexToTDX:p},e.exports=t.default},function(e,t,a){"use strict";function o(e){var t=0;if(0==e.length)return t;for(var a=0;a<e.length;a++){t=(t<<5)-t+e.charCodeAt(a),t&=t}return t}function r(e,t){function a(e){return"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[e]}t=t||62;var o,r=[],s="",n=e<0?"-":"";for(e=Math.abs(e);e>=t;)o=e%t,e=Math.floor(e/t),r.push(a(o));e>0&&r.push(a(e));for(var u=r.length-1;u>=0;u--)s+=r[u];return n+s}function s(e){return r(o(e),61).replace("-","Z")}Object.defineProperty(t,"__esModule",{value:!0}),t.default={bitwise:o,binaryTransfer:r,unique:s},e.exports=t.default},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseFunction=t.splitTDXAccount=t.makeTDXAccount=t.isNumeric=t.isHostNameValid=t.isDateValid=t.isEmailValid=t.shortHash=t.buildDataKey=t.flattenJSON=t.schemaUtils=t.databotUtils=t.resourceUtils=t.constants=void 0;var r=a(0),s=o(r),n=a(6),u=o(n),i=a(4),c=o(i),d=a(7),l=o(d),p=a(5),f=o(p),y=a(3),b=o(y),_=a(8),h=o(_),m=function(e){return/^[A-Z0-9'.1234z_%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)},v=function(e){return/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/.test(e)},T=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},g=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},x=function(e,t){return e+"/"+t},D=function(e){var t=void 0,a=e.toLowerCase().split("/");return 2===a.length&&m(a[0])&&(v(a[1])||0===a[1].indexOf("localhost:"))&&(t={email:a[0],tdx:a[1]}),t},R=function(e){var t=/function *\(([^()]*)\)[ \n\t]*{(.*)}/gim,a=t.exec(e.replace(/\n/g," "));return a?new Function(a[1].split(","),a[2]):null};t.constants=s.default,t.resourceUtils=u.default,t.databotUtils=c.default,t.schemaUtils=l.default,t.flattenJSON=f.default,t.buildDataKey=b.default,t.shortHash=h.default,t.isEmailValid=m,t.isDateValid=T,t.isHostNameValid=v,t.isNumeric=g,t.makeTDXAccount=x,t.splitTDXAccount=D,t.parseFunction=R},function(e,a){e.exports=t}])});