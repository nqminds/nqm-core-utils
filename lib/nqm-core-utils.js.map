{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 50cf4e20c83e90ddc3a3","webpack:///./src/constants.js","webpack:///external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"_\",\"root\":\"_\"}","webpack:///./src/short-hash.js","webpack:///external \"debug\"","webpack:///./src/build-data-key.js","webpack:///./src/databot-utils.js","webpack:///./src/flatten.js","webpack:///./src/resource-utils.js","webpack:///./src/schema-utils.js","webpack:///external \"shortid\"","webpack:///./src/index.js","webpack:///external \"mongo-parse\""],"names":["readAccess","writeAccess","publicRWShareMode","publicROShareMode","trustedShareMode","resourceEventType","accountEventType","mongooseTypes","vocabularyResourceType","schemaResourceType","datasetResourceType","visualisationResourceType","groupResourceType","rootGroupResourceType","rawFileResourceType","applicationBaseType","applicationDefinitionResourceType","databotBaseType","databotDefinitionResourceType","databotHostResourceType","accountSetBaseType","accountSetResourceType","resourceRootGroupResourceType","scratchGroupResourceType","datasetFilterResourceType","geojsonResourceType","widgetVisualisationResourceType","timeSeriesVisualisationResourceType","mapVisualisationResourceType","statusVisualisationResourceType","databotRootGroupResourceType","databotDefinitionGroupResourceType","databotHostGroupResourceType","databotInstanceGroupResourceType","databotActiveHostGroupResourceType","databotControllerResourceType","applicationRootGroupResourceType","applicationDefinitionGroupResourceType","applicationServerGroupResourceType","applicationDataGroupResourceType","accountSetRootGroupResourceType","accountSetGroupResourceType","databotInstancesResourceType","databotInstanceOutputResourceType","databotProcessesResourceType","activeDatabotHostsResourceType","userAccountType","tokenAccountType","hostAccountType","applicationAccountType","accountSetAccountType","schemasResourceId","vocabularyResourceId","npmDatabotType","inlineDatabotType","zipDatabotType","githubDatabotType","urlDatabotType","browserHostType","serverHostType","databotInstancesResourceId","databotInstanceOutputResourceId","databotProcessesResourceId","activeDatabotHostsResourceId","unallocatedDatabotStatus","pendingDatabotStatus","installingDatabotStatus","partRunningDatabotStatus","runningDatabotStatus","pausedDatabotStatus","stoppingDatabotStatus","completeDatabotStatus","errorDatabotStatus","immediateDatabotInstanceRunMode","alwaysDatabotInstanceRunMode","scheduledDatabotInstanceRunMode","pauseDatabotInstance","resumeDatabotInstance","stopDatabotInstance","datasetImportDatabot","datasetCopyDatabot","onlineHostStatus","offlineHostStatus","idleHostStatus","busyHostStatus","errorHostStatus","resourceVocabularyId","datasetVocabularyId","folderVocabularyId","rawFileVocabularyId","visualisationVocabularyId","schemaVocabularyId","databotDefinitionVocabularyId","urlVocabularyId","builtIndexStatus","pendingIndexStatus","suspendingIndexStatus","suspendedIndexStatus","errorIndexStatus","githubAuthService","googleAuthService","localAuthService","guestAccount","maxTimestamp","datasetStorePrefix","rootFolderPrefix","rootFolderName","scratchFolderPrefix","scratchFolderName","scratchFolderAlias","resourceRootFolderPrefix","resourceRootFolderName","accountSetRootFolderPrefix","accountSetRootFolderName","applicationRootFolderPrefix","applicationRootFolderName","applicationDefinitionFolderPrefix","applicationDefinitionFolderName","applicationServerFolderPrefix","applicationServerFolderName","applicationDataFolderPrefix","applicationDataFolderName","applicationServerDataFolderPrefix","databotRootFolderPrefix","databotRootFolderName","databotDefinitionFolderPrefix","databotDefinitionFolderName","databotHostFolderPrefix","databotHostFolderName","databotInstanceFolderPrefix","databotInstanceFolderName","databotActiveHostFolderPrefix","databotActiveHostFolderName","readOnlyOwnershipMode","userOwnershipMode","appOwnershipMode","impersonateAccessMode","shareAccessMode","identityFilterPlaceholder","authenticateApplicationId","toolboxApplicationId","bitwise","str","hash","length","i","ch","charCodeAt","binaryTransfer","integer","binary","stack","num","result","sign","table","t","Math","abs","floor","push","unique","text","id","replace","errLog","buildDataKey","fieldPaths","params","failIfIncomplete","keys","forEach","f","key","asc","desc","pointers","DotNotationPointers","val","Error","JSON","stringify","isDatabotInstanceRunning","databotInstance","status","flattenJSON","data","recurse","cur","prop","Object","Array","isArray","l","isEmpty","p","pureResourceTypes","isResourceType","resource","type","concat","schemaDefinition","indexOf","intersection","basedOn","baseType","getResourceTypeText","scheduledTasksResourceType","processHostsResourceType","getShareModeText","shareMode","display","primaryKeyFromFlattened","datum","uniqueIndex","idx","keyField","getAccountRootId","accountId","specialFolderId","getResourceRootId","getApplicationRootId","getApplicationDefinitionId","getApplicationDataId","getDatabotRootId","getAccountSetRootId","getDefaultResourceParent","rootId","isPureResource","isAccountSet","isAccountSetRootGroup","isAccountSetGroup","isApplicationDefinition","isApplicationDefinitionGroup","isDatabotDefinitionGroup","isDatabotHostGroup","isDataset","isDatasetOrRawFile","datasetOrRaw","isDatasetFilter","isGeoJSON","isResourceRootGroup","isSchema","isScratchGroup","isVocabulary","isPlainResourceGroup","folder","isEqual","isReadOnlyGroup","isReservedGroup","prefix","log","reservedFieldNames","vocabTypeLookupMongoose","vocab","vocabDefinition","find","v","vocabTypeLookupTDX","indexToTDX","indexFields","errList","tdxIndex","fieldSpec","sortDirection","indexToMongoose","index","mongooseIndex","validateTDXType","properType","toLowerCase","schemaToTDX","schema","value","__tdxType","validateMongooseType","capitalize","schemaToMongoose","forDisplay","each","k","required","__tdxRequired","default","__tdxDefault","description","__tdxDescription","definitionToMongoose","name","tdxSchema","indexes","nonUniqueIndexes","nonUniqueIndex","primaryIndex","dataSchema","mongooseSchema","join","cloneDeep","isEmailValid","address","test","isHostNameValid","hostname","isDateValid","d","prototype","toString","call","isNaN","getTime","isNumeric","n","parseFloat","isFinite","makeTDXAccount","email","tdx","splitTDXAccount","account","username","split","makeTDXResourceId","splitTDXResourceId","resourceId","splitTDXSchemaId","schemaId","libraryId","padNumber","width","z","parseFunction","funcText","funcReg","match","exec","Function","parseTDXError","err","parsed","parse","message","failure","parseError","from","code","unCamelCase","inp","toUpperCase","slugify","trim","shortId","constants","databotUtils","resourceUtils","schemaUtils","shortHash"],"mappings":"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","file":"nqm-core-utils.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"debug\"), require(\"shortid\"), require(\"mongo-parse\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"nqm-core-utils\", [\"_\", \"debug\", \"shortid\", \"mongo-parse\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"nqm-core-utils\"] = factory(require(\"lodash\"), require(\"debug\"), require(\"shortid\"), require(\"mongo-parse\"));\n\telse\n\t\troot[\"nqm-core-utils\"] = factory(root[\"_\"], root[\"debug\"], root[\"shortid\"], root[\"mongo-parse\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_9__, __WEBPACK_EXTERNAL_MODULE_11__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 50cf4e20c83e90ddc3a3","/* eslint-disable key-spacing, max-len */\nexport default {\n  // Resource access types\n  readAccess:  \"r\",\n  writeAccess: \"w\",\n\n  // Share modes\n  publicRWShareMode: \"pw\",    // public read and write\n  publicROShareMode: \"pr\",    // public read, trusted write\n  trustedShareMode:  \"tr\",    // trusted only\n\n  // Event types\n  resourceEventType: \"Resource\",\n  accountEventType:  \"Account\",\n\n  mongooseTypes: {\n    \"string\": 1,\n    \"number\": 1,\n    \"date\": 1,\n    \"boolean\": 1,\n  },\n\n  // Resource types (schema ids)\n  vocabularyResourceType:                 \"vocabulary\",\n  schemaResourceType:                     \"schema\",\n  datasetResourceType:                    \"dataset\",\n  visualisationResourceType:              \"visualisation\",\n  groupResourceType:                      \"resourceGroup\",             // generic folder\n  rootGroupResourceType:                  \"rootGroup\",                 // user root folder - holds all account resources\n  rawFileResourceType:                    \"rawFile\",\n  applicationBaseType:                    \"applicationBase\",\n  applicationDefinitionResourceType:      \"applicationDefinition\",     // system resources that mirror applicationAccountType accounts to enable sharing\n  databotBaseType:                        \"databot\",                   // base of all things 'databot'\n  databotDefinitionResourceType:          \"databotDefinition\",         // a databot definition\n  databotHostResourceType:                \"databotHost\",               // system resources that mirror hostAccountType accounts to enable sharing\n  accountSetBaseType:                     \"accountSetBase\",\n  accountSetResourceType:                 \"accountSet\",\n\n  resourceRootGroupResourceType:          \"resourceRootGroup\",         // folder for all 'pure' resources (non-databot or application)\n  scratchGroupResourceType:               \"scratchGroup\",\n  datasetFilterResourceType:              \"datasetFilter\",\n  geojsonResourceType:                    \"geojson\",\n\n  widgetVisualisationResourceType:        \"widgetVisualisation\",\n  timeSeriesVisualisationResourceType:    \"timeSeriesVisualisation\",\n  mapVisualisationResourceType:           \"mapVisualisation\",\n  statusVisualisationResourceType:        \"statusVisualisation\",\n\n  databotRootGroupResourceType:           \"databotRootGroup\",\n  databotDefinitionGroupResourceType:     \"databotGroup\",\n  databotHostGroupResourceType:           \"databotHostGroup\",\n  databotInstanceGroupResourceType:       \"databotInstanceGroup\",\n  databotActiveHostGroupResourceType:     \"databotActiveHostGroup\",\n  databotControllerResourceType:          \"databotController\",\n\n  applicationRootGroupResourceType:       \"applicationRootGroup\",\n  applicationDefinitionGroupResourceType: \"applicationDefinitionGroup\",\n  applicationServerGroupResourceType:     \"applicationServerGroup\",\n  applicationDataGroupResourceType:       \"applicationDataGroup\",\n\n  accountSetRootGroupResourceType:        \"accountSetRootGroup\",\n  accountSetGroupResourceType:            \"accountSetGroup\",\n\n  // databot management resources\n  databotInstancesResourceType:           \"databotInstances\",          // system resource storing details of running databot instances\n  databotInstanceOutputResourceType:      \"databotInstanceOutput\",     // system resource storing databot instance output\n  databotProcessesResourceType:           \"databotProcesses\",          // system resource storing databot process info\n  activeDatabotHostsResourceType:         \"activeDatabotHosts\",        // system resource storing details of active databot hosts\n\n  // Account types\n  userAccountType:  \"user\",\n  tokenAccountType: \"token\",\n  hostAccountType: \"host\",\n  applicationAccountType: \"application\",\n  accountSetAccountType: \"accountSet\",\n\n  // Default schema resource\n  schemasResourceId: \"__schemas__\",\n\n  // Default vocabulary resource\n  vocabularyResourceId: \"__vocab__\",\n\n  // Databot stuff.\n  npmDatabotType: \"npm\",\n  inlineDatabotType: \"script\",\n  zipDatabotType: \"zip\",\n  githubDatabotType: \"github\",\n  urlDatabotType: \"url\",\n\n  browserHostType: \"browser\",\n  serverHostType:  \"server\",\n\n  databotInstancesResourceId:      \"__databotInstances__\",\n  databotInstanceOutputResourceId: \"__databotInstanceOutput__\",\n  databotProcessesResourceId:      \"__databotProcesses__\",\n  activeDatabotHostsResourceId:    \"__activeDatabotHosts__\",\n\n  unallocatedDatabotStatus: \"unallocated\",\n  pendingDatabotStatus:     \"pending\",\n  installingDatabotStatus:  \"installing\",\n  partRunningDatabotStatus: \"partRunning\",\n  runningDatabotStatus:     \"running\",\n  pausedDatabotStatus:      \"paused\",\n  stoppingDatabotStatus:    \"stopping\",\n  completeDatabotStatus:    \"complete\",\n  errorDatabotStatus:       \"error\",\n\n  immediateDatabotInstanceRunMode: \"run-now\",\n  alwaysDatabotInstanceRunMode:    \"run-always\",\n  scheduledDatabotInstanceRunMode: \"scheduled\",\n\n  pauseDatabotInstance: \"pause\",\n  resumeDatabotInstance: \"resume\",\n  stopDatabotInstance: \"stop\",\n\n  // Privileged databots\n  datasetImportDatabot:     \"__datasetImport__\",\n  datasetCopyDatabot:       \"__datasetCopy__\",\n\n  onlineHostStatus:  \"online\",\n  offlineHostStatus: \"offline\",\n  idleHostStatus:    \"idle\",\n  busyHostStatus:    \"busy\",\n  errorHostStatus:   \"error\",\n\n  resourceVocabularyId:          \"ResourceId\",\n  datasetVocabularyId:           \"DatasetId\",\n  folderVocabularyId:            \"FolderId\",\n  rawFileVocabularyId:           \"RawFileId\",\n  visualisationVocabularyId:     \"VisualisationId\",\n  schemaVocabularyId:            \"SchemaId\",\n  databotDefinitionVocabularyId: \"DatabotDefinitionId\",\n  urlVocabularyId:               \"Url\",\n\n  // Index status\n  builtIndexStatus:      \"built\",\n  pendingIndexStatus:    \"pending\",\n  suspendingIndexStatus: \"suspending\",\n  suspendedIndexStatus:  \"suspended\",\n  errorIndexStatus:      \"error\",\n\n  // Authentication services\n  githubAuthService:     \"oauth:github\",\n  googleAuthService:     \"oauth:google\",\n  localAuthService:      \"local\",\n\n  // Misc\n  guestAccount: \"...guest...\",\n  maxTimestamp: 8640000000000000,\n  datasetStorePrefix: \"dataset.\",\n\n  // Special folders\n  rootFolderPrefix: \"r.\",\n  rootFolderName: \"root\",\n\n  scratchFolderPrefix: \"s.\",\n  scratchFolderName: \"scratch\",\n  scratchFolderAlias: \"__scratch__\",      // Used in code to refer to the current users scratch folder.\n\n  resourceRootFolderPrefix: \"rs.\",\n  resourceRootFolderName: \"resources\",\n\n  accountSetRootFolderPrefix: \"ug.\",\n  accountSetRootFolderName: \"user groups\",\n\n  applicationRootFolderPrefix: \"a.\",\n  applicationRootFolderName: \"applications\",\n\n  applicationDefinitionFolderPrefix: \"adef.\",\n  applicationDefinitionFolderName: \"application definitions\",\n\n  applicationServerFolderPrefix: \"as.\",\n  applicationServerFolderName: \"application servers\",\n\n  applicationDataFolderPrefix: \"ad.\",\n  applicationDataFolderName: \"authorised applications\",\n\n  // For application-specific folders where app servers can store data.\n  // Created as sub-folders of applicationServerFolderPrefix.\n  // Will use the application name, e.g. \"careshare server data\".\n  applicationServerDataFolderPrefix: \"adat.\",\n\n  databotRootFolderPrefix: \"dbr.\",\n  databotRootFolderName: \"databots\",\n\n  databotDefinitionFolderPrefix: \"db.\",\n  databotDefinitionFolderName: \"databot definitions\",\n\n  databotHostFolderPrefix: \"dh.\",\n  databotHostFolderName: \"databot hosts\",\n\n  databotInstanceFolderPrefix: \"dbi.\",\n  databotInstanceFolderName: \"databot instances\",\n\n  databotActiveHostFolderPrefix: \"dah.\",\n  databotActiveHostFolderName: \"active databot hosts\",\n\n  // Application data ownership modes\n  readOnlyOwnershipMode: \"read-only\",\n  userOwnershipMode: \"user\",\n  appOwnershipMode: \"application\",\n\n  // Application data access modes\n  impersonateAccessMode: \"impersonate\",\n  shareAccessMode: \"shared\",\n\n  // Identity filter placeholder\n  identityFilterPlaceholder: \"@@_identity_@@\",\n\n  // Application ids\n  authenticateApplicationId: \"__authenticate__\",\n  toolboxApplicationId: \"__toolbox__\",\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/constants.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"_\",\"root\":\"_\"}\n// module id = 1\n// module chunks = 0","/* eslint-disable */\n/*\n\tshorthash\n\t(c) 2013 Bibig\n\t\n\thttps://github.com/bibig/node-shorthash\n\tshorthash may be freely distributed under the MIT license.\n*/\n\n// refer to: http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/\nfunction bitwise(str){\n\tvar hash = 0;\n\tif (str.length == 0) return hash;\n\tfor (var i = 0; i < str.length; i++) {\n\t\tvar ch = str.charCodeAt(i);\n\t\thash = ((hash<<5)-hash) + ch;\n\t\thash = hash & hash; // Convert to 32bit integer\n\t}\n\treturn hash;\n}\n\n// 10进制转化成62进制以内的进制\n// convert 10 binary to customized binary, max is 62\nfunction binaryTransfer(integer, binary) {\n\tbinary = binary || 62;\n\tvar stack = [];\n\tvar num;\n\tvar result = '';\n\tvar sign = integer < 0 ? '-' : '';\n\t\n\tfunction table (num) {\n\t\tvar t = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\t\treturn t[num];\n\t}\n\t\n\tinteger = Math.abs(integer);\n\t\n\twhile (integer >= binary) {\n\t\tnum = integer % binary;\n\t\tinteger = Math.floor(integer / binary);\n\t\tstack.push(table(num));\n\t}\n\t\n\tif (integer > 0) {\n\t\tstack.push(table(integer));\n\t}\n\t\n\tfor (var i = stack.length - 1; i >= 0; i--) {\n\t\tresult += stack[i];\n\t} \n\t\n\treturn sign + result;\n}\n\n\n/**\n * why choose 61 binary, because we need the last element char to replace the minus sign\n * eg: -aGtzd will be ZaGtzd\n */\nfunction unique (text) {\n\tvar id = binaryTransfer(bitwise(text), 61);\n\treturn id.replace('-', 'Z');\n}\n\nexport default {\n  bitwise,\n  binaryTransfer,\n  unique\n};\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/short-hash.js","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 3\n// module chunks = 0","import debug from \"debug\";\nimport parser from \"mongo-parse\";\nimport _ from \"lodash\";\n\nconst errLog = debug(\"nqm-core-utils:build-data-key\");\n\n/*\n  * Extract a dictionary of values from params corresponding to the given array of field paths,\n  * where paths use the dot notation, e.g. address.postcode.\n  */\nconst buildDataKey = function(fieldPaths, params, failIfIncomplete) {\n  const keys = {};\n  _.forEach(fieldPaths, function(f) {\n    // Get the field path.\n    const key = f.asc || f.desc;\n    const pointers = parser.DotNotationPointers(params, key);\n    if (pointers.length === 0 || typeof pointers[0].val === \"undefined\") {\n      errLog(\"no key data for field '%s' in %j\", key, params);\n      if (failIfIncomplete) {\n        throw new Error(`buildDataKey - incomplete primary key: no data for '${key}' in ${JSON.stringify(params)}`);\n      }\n    } else {\n      keys[key] = pointers[0].val;\n    }\n  });\n\n  return keys;\n};\n\nexport default buildDataKey;\n\n\n\n// WEBPACK FOOTER //\n// ./src/build-data-key.js","import constants from \"./constants\";\n\nconst isDatabotInstanceRunning = function(databotInstance) {\n  return databotInstance && (\n    databotInstance.status === constants.runningDatabotStatus ||\n    databotInstance.status === constants.installingDatabotStatus ||\n    databotInstance.status === constants.partRunningDatabotStatus ||\n    databotInstance.status === constants.pausedDatabotStatus\n  );\n};\n\nexport default {\n  isDatabotInstanceRunning: isDatabotInstanceRunning,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/databot-utils.js","const flattenJSON = function(data) {\n  const result = {};\n  function recurse(cur, prop) {\n    if (Object(cur) !== cur) {\n      result[prop] = cur;\n    } else if (Array.isArray(cur)) {\n      const l = cur.length;\n      for (let i = 0; i < l; i++) {\n        recurse(cur[i], `${prop}.${i}`);\n      }\n      if (l === 0)\n        result[prop] = [];\n    } else {\n      let isEmpty = true;\n      for (const p in cur) {\n        isEmpty = false;\n        recurse(cur[p], prop ? `${prop}.${p}` : p);\n      }\n      if (isEmpty && prop)\n        result[prop] = {};\n    }\n  }\n  recurse(data, \"\");\n  return result;\n};\n\nexport default flattenJSON;\n\n\n\n// WEBPACK FOOTER //\n// ./src/flatten.js","import constants from \"./constants\";\nimport _ from \"lodash\";\nimport shortHash from \"./short-hash\";\n\n// A 'pure' resource is any non-databot and non-application resource.\nconst pureResourceTypes = [\n  constants.datasetResourceType,\n  constants.groupResourceType,\n  constants.rawFileResourceType,\n];\n\nconst isResourceType = function(resource, type) {\n  type = [].concat(type);\n  resource = resource || {};\n  return (\n    resource.schemaDefinition ? (\n      type.indexOf(resource.schemaDefinition.id) >= 0 ||\n      _.intersection(resource.schemaDefinition.basedOn || [], type).length > 0\n    ) : (\n      type.indexOf(resource.baseType) >= 0\n    )\n  );\n};\n\nconst getResourceTypeText = function(type) {\n  let text;\n  switch (type) {\n    case constants.groupResourceType:\n      text = \"folder\";\n      break;\n    case constants.rawFileResourceType:\n      text = \"raw file\";\n      break;\n    case constants.widgetVisualisationResourceType:\n      text = \"widget visualisation\";\n      break;\n    case constants.timeSeriesVisualisationResourceType:\n      text = \"time series visualisation\";\n      break;\n    case constants.mapVisualisationResourceType:\n      text = \"map visualisation\";\n      break;\n    case constants.statusVisualisationResourceType:\n      text = \"status visualisation\";\n      break;\n    case constants.scheduledTasksResourceType:\n      text = \"scheduled tasks\";\n      break;\n    case constants.processHostsResourceType:\n      text = \"process hosts\";\n      break;\n    default:\n      // Most single word resource types are OK.\n      text = type;\n      break;\n  }\n  return text;\n};\n\nconst getShareModeText = function(shareMode) {\n  let display;\n  switch (shareMode) {\n    case constants.publicRWShareMode:\n      display = \"public view and edit\";\n      break;\n    case constants.publicROShareMode:\n      display = \"public view, trusted edit\";\n      break;\n    case constants.trustedShareMode:\n      display = \"trusted only\";\n      break;\n    default:\n      display = \"!!unknown!!\";\n      break;\n  }\n  return display;\n};\n\nconst primaryKeyFromFlattened = function(resource, datum) {\n  // Create primary key from flattened data.\n  const key = {};\n  _.forEach(resource.schemaDefinition.uniqueIndex, (idx) => {\n    const keyField = idx.asc || idx.desc;\n    key[keyField] = datum[keyField];\n  });\n\n  return key;\n};\n\n// Users root folder.\nconst getAccountRootId = function(accountId) {\n  return specialFolderId(constants.rootFolderPrefix, accountId);\n};\n\n// Folder containing all 'pure' resources belonging to the user.\nconst getResourceRootId = function(accountId) {\n  return specialFolderId(constants.resourceRootFolderPrefix, accountId);\n};\n\n// Folder containing all application-specific data for the user.\nconst getApplicationRootId = function(accountId) {\n  return specialFolderId(constants.applicationRootFolderPrefix, accountId);\n};\n\n// Folder containing application definitions created by the user.\nconst getApplicationDefinitionId = function(accountId) {\n  return specialFolderId(constants.applicationDefinitionFolderPrefix, accountId);\n};\n\n// Folder containing a users application data.\nconst getApplicationDataId = function(accountId) {\n  return specialFolderId(constants.applicationDataFolderPrefix, accountId);\n};\n\n// Folder containing all databot-specific data for the user.\nconst getDatabotRootId = function(accountId) {\n  return specialFolderId(constants.databotRootFolderPrefix, accountId);\n};\n\n// Folder containing all account set specific data for the user.\nconst getAccountSetRootId = function(accountId) {\n  return specialFolderId(constants.accountSetRootFolderPrefix, accountId);\n};\n\n//\n// Gets the default parent for a given resource type.\n// This is used when a resource is created with no parent specified.\n//\nconst getDefaultResourceParent = function(accountId, baseType) {\n  let rootId;\n  switch (baseType) {\n    case constants.datasetResourceType:\n      rootId = getResourceRootId(accountId);\n      break;\n    case constants.applicationBaseType:\n      rootId = getApplicationRootId(accountId);\n      break;\n    case constants.databotBaseType:\n      rootId = getDatabotRootId(accountId);\n      break;\n    case constants.accountSetBaseType:\n      rootId = getAccountSetRootId(accountId);\n      break;\n    default:\n      // Do nothing\n      break;\n  }\n  return rootId;\n};\n\nconst isPureResource = function(baseType) {\n  return pureResourceTypes.indexOf(baseType) >= 0;\n};\n\nconst isAccountSet = function(resource) {\n  return isResourceType(resource, constants.accountSetResourceType);\n};\n\nconst isAccountSetRootGroup = function(resource) {\n  return isResourceType(resource, constants.accountSetRootGroupResourceType);\n};\n\nconst isAccountSetGroup = function(resource) {\n  return isResourceType(resource, constants.accountSetGroupResourceType);\n};\n\nconst isApplicationDefinition = function(resource) {\n  return isResourceType(resource, constants.applicationDefinitionResourceType);\n};\n\nconst isApplicationDefinitionGroup = function(resource) {\n  return isResourceType(resource, constants.applicationDefinitionGroupResourceType);\n};\n\nconst isDatabotDefinitionGroup = function(resource) {\n  return isResourceType(resource, constants.databotDefinitionGroupResourceType);\n};\n\nconst isDatabotHostGroup = function(resource) {\n  return isResourceType(resource, constants.databotHostGroupResourceType);\n};\n\nconst isDataset = function(resource) {\n  return isResourceType(resource, constants.datasetResourceType);\n};\n\nconst isDatasetOrRawFile = function(resource) {\n  const datasetOrRaw = [constants.datasetResourceType, constants.rawFileResourceType];\n  return isResourceType(resource, datasetOrRaw);\n};\n\nconst isDatasetFilter = function(resource) {\n  return isResourceType(resource, constants.datasetFilterResourceType);\n};\n\nconst isGeoJSON = function(resource) {\n  return isResourceType(resource, constants.geojsonResourceType);\n};\n\nconst isResourceRootGroup = function(resource) {\n  return isResourceType(resource, constants.resourceRootGroupResourceType);\n};\n\nconst isSchema = function(resource) {\n  return isResourceType(resource, constants.schemaResourceType);\n};\n\nconst isScratchGroup = function(resource) {\n  return isResourceType(resource, constants.scratchGroupResourceType);\n};\n\nconst isVocabulary = function(resource) {\n  return isResourceType(resource, constants.vocabularyResourceType);\n};\n\nconst isPlainResourceGroup = (folder) => {\n  // Determine if the folder is a simple groupResourceType (no sub-class)\n  return (\n    folder &&\n    folder.schemaDefinition &&\n    _.isEqual(\n      folder.schemaDefinition.basedOn || [],\n      [constants.groupResourceType])\n  );\n};\n\nconst isReadOnlyGroup = (folder) => {\n  //\n  // Read-only groups => resources can not be created in folders of the following type.\n  //\n  return (\n    isResourceType(folder, constants.applicationRootGroupResourceType) ||\n    isResourceType(folder, constants.databotRootGroupResourceType) ||\n    isResourceType(folder, constants.databotInstanceGroupResourceType) ||\n    isResourceType(folder, constants.rootGroupResourceType)\n  );\n};\n\nconst isReservedGroup = (folder) => {\n  //\n  // Reserved groups => resources can not be created with the following types.\n  //\n  return (\n    isResourceType(folder, constants.accountSetRootGroupResourceType) ||\n    isResourceType(folder, constants.applicationRootGroupResourceType) ||\n    isResourceType(folder, constants.applicationDataGroupResourceType) ||\n    isResourceType(folder, constants.applicationServerGroupResourceType) ||\n    isResourceType(folder, constants.databotRootGroupResourceType) ||\n    isResourceType(folder, constants.databotInstanceGroupResourceType) ||\n    isResourceType(folder, constants.resourceRootGroupResourceType) ||\n    isResourceType(folder, constants.rootGroupResourceType)\n  );\n};\n\nconst specialFolderId = function(prefix, accountId) {\n  return shortHash.unique(prefix + accountId);\n};\n\nexport default {\n  getAccountRootId: getAccountRootId,\n  getAccountSetRootId,\n  getApplicationRootId: getApplicationRootId,\n  getDatabotRootId: getDatabotRootId,\n  getApplicationDataId: getApplicationDataId,\n  getApplicationDefinitionId: getApplicationDefinitionId,\n  getDefaultResourceParent: getDefaultResourceParent,\n  getResourceRootId: getResourceRootId,\n  getResourceTypeText: getResourceTypeText,\n  getShareModeText: getShareModeText,\n  isAccountSet,\n  isAccountSetGroup,\n  isAccountSetRootGroup,\n  isApplicationDefinition,\n  isApplicationDefinitionGroup,\n  isDatabotDefinitionGroup,\n  isDatabotHostGroup,\n  isDataset,\n  isDatasetOrRawFile,\n  isDatasetFilter,\n  isGeoJSON,\n  isPlainResourceGroup,\n  isPureResource,\n  isReadOnlyGroup,\n  isReservedGroup,\n  isResourceRootGroup,\n  isResourceType,\n  isSchema,\n  isScratchGroup,\n  isVocabulary,\n  primaryKeyFromFlattened: primaryKeyFromFlattened,\n  specialFolderId: specialFolderId,\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/resource-utils.js","/* eslint-disable no-underscore-dangle */\nimport debug from \"debug\";\nimport _ from \"lodash\";\nimport constants from \"./constants\";\n\nconst log = debug(\"nqm-core-utils:build-data-key\");\nconst errLog = debug(\"nqm-core-utils:build-data-key:error\");\n\n// From mongoose/lib/schema.js\nconst reservedFieldNames = [\n  \"_id\",              // <---- TDX specific\n  \"prototype\",\n  // EventEmitter\n  \"emit\",\n  \"on\",\n  \"once\",\n  \"listeners\",\n  \"removeListener\",\n  // document properties and functions\n  \"collection\",\n  \"db\",\n  \"errors\",\n  \"init\",\n  \"isModified\",\n  \"isNew\",\n  \"get\",\n  \"modelName\",\n  \"save\",\n  \"schema\",\n  \"set\",\n  \"toObject\",\n  \"validate\",\n  \"remove\",\n  // hooks.js\n  \"_pres\",\n  \"_posts\",\n  \"__update\",         // <---- TDX specific\n];\n\nconst vocabTypeLookupMongoose = function(vocab, id) {\n  const vocabDefinition = _.find(vocab, (v) => v.id === id);\n  return vocabDefinition && vocabDefinition.basedOn[0];\n};\n\nconst vocabTypeLookupTDX = function(vocab, id) {\n  const vocabDefinition = _.find(vocab, (v) => v.id === id);\n  return vocabDefinition && vocabDefinition.basedOn.concat(vocabDefinition.id);\n};\n\n// Convert from simple array list to TDX index format.\n// Assume ascending sort direction.\n// e.g. [\"id\", \"code\"] => [{asc: \"id\"}, {asc: \"code\"}]\n//\n// Will also convert from mongoose index spec to tdx format.\n// e.g. {id: 1, code: -1} => [{asc: \"id\"}, {desc: \"code\"}]\n//\nconst indexToTDX = function(indexFields, errList) {\n  const tdxIndex = [];\n  errList = errList || [];\n\n  if (Array.isArray(indexFields)) {\n    _.forEach(indexFields, function(fieldSpec) {\n      if (typeof fieldSpec === \"string\") {\n        tdxIndex.push({\"asc\": fieldSpec});\n      } else if (fieldSpec.asc || fieldSpec.desc) {\n        tdxIndex.push(fieldSpec);\n      } else {\n        errList.push(`invalid index spec: ${JSON.stringify(fieldSpec)}`);\n      }\n    });\n  } else if (typeof indexFields === \"object\") {\n    _.forEach(indexFields, function(sortDirection, key) {\n      if (sortDirection === -1) {\n        tdxIndex.push({desc: key});\n      } else {\n        tdxIndex.push({asc: key});\n      }\n    });\n  }\n\n  return tdxIndex;\n};\n\nconst indexToMongoose = function(index) {\n  const mongooseIndex = {};\n  _.forEach(index, function(i) {\n    mongooseIndex[i.asc || i.desc] = (i.asc ? 1 : -1);\n  });\n\n  return mongooseIndex;\n};\n\nconst validateTDXType = function(vocab, type, errList) {\n  let properType = vocabTypeLookupTDX(vocab, type);\n  if (!properType) {\n    type = type.toLowerCase();\n    if (!constants.mongooseTypes[type]) {\n      errList.push(`invalid base type: ${type}`);\n    } else {\n      properType = [type];\n    }\n  }\n\n  return properType;\n};\n\n/**\n * Converts a schema from mongoose to TDX format.\n * n.b. recursive\n * @param  {} schema\n * @param  {} errList\n */\nconst schemaToTDX = function(vocab, schema, errList) {\n  if (typeof schema === \"object\") {\n    _.forEach(schema, function(value, key) {\n      if (key === \"__tdxType\") {\n        // Ensure array type list.\n        schema.__tdxType = [].concat(value);\n      } else if (key === \"type\") {\n        // Convert to TDX format.\n        if (typeof value === \"string\") {\n          // A mongoose-style type specification, e.g. {\"name\": {\"type\": \"string\"}}\n          // Convert to array type spec.\n          schema.__tdxType = validateTDXType(vocab, value, errList);\n          delete schema.type;\n        } else if (Array.isArray(value)) {\n          // An array type spec.\n          if (value.length) {\n            if (typeof value[0] === \"object\") {\n              // A type specification for a type named 'type' as an array, groan...\n              // e.g. {type: [{type: \"string\"}]} - an array of strings\n              schema[key] = schemaToTDX(vocab, value, errList);\n            } else {\n              // A mixed mongoose/TDX type specification, e.g. {\"name\": {\"type\": [\"string\", \"resourceId\", \"datasetId\"]}}\n              // A TDX-style list of vocab hierarchy => already TDX format, but validate root type\n              validateTDXType(vocab, value[0], errList);\n              schema.__tdxType = value;\n              delete schema.type;\n            }\n          } else {\n            // An emtpy array for the 'type' key => assume a 'mixed' mongoose type.\n            schema[key] = [];\n          }\n        } else if (typeof value === \"object\") {\n          // An object spec => recurse\n          schema[key] = schemaToTDX(vocab, value, errList);\n        } else {\n          errList.push(`invalid schema definition, invalid 'type' spec: ${schema}`);\n        }\n      } else if (key === \"__tdxRequired\" || key === \"__tdxDefault\" || key === \"__tdxDescription\") {\n        // Do nothing.\n      } else if (Array.isArray(value)) {\n        if (value.length === 1) {\n          value[0] = schemaToTDX(vocab, value[0], errList);\n        } else if (value.length) {\n          // Multi-value array => a mongoose-style TDX vocab list, e.g. {cost: [\"number\", \"currency\"]}\n          schema[key] = {__tdxType: value};\n        } else {\n          // Assume a 'mixed' mongoose type.\n          schema[key] = [];\n        }\n      } else if (typeof value === \"object\") {\n        // Recurse for sub-documents\n        schema[key] = schemaToTDX(vocab, value, errList);\n      } else if (typeof value === \"string\") {\n        // An implied type spec, e.g. {name: \"string\"} - convert to TDX\n        schema[key] = {__tdxType: validateTDXType(vocab, value, errList)};\n      } else {\n        errList.push(`invalid schema definition, unexpected: ${schema}`);\n      }\n    });\n\n    return schema;\n  } else if (typeof schema === \"string\") {\n    return {__tdxType: validateTDXType(vocab, schema, errList)};\n  } else {\n    errList.push(`invalid schema definition, unexpected: ${schema}`);\n  }\n};\n\nconst validateMongooseType = function(vocab, type, errList) {\n  let properType;\n  type = vocabTypeLookupMongoose(vocab, type) || type;\n  type = type.toLowerCase();\n  if (!constants.mongooseTypes[type]) {\n    errList.push(`invalid base type: ${type}`);\n  } else {\n    properType = _.capitalize(type);\n  }\n  return properType;\n};\n\n// Converts a schema from TDX to mongoose format.\nconst schemaToMongoose = function(vocab, schema, errList, forDisplay) {\n  errList = errList || [];\n\n  _.each(schema, function(v, k) {\n    if (reservedFieldNames.indexOf(k) >= 0) {\n      errLog(\"invalid field name (reserved): %s\", k);\n      errList.push(`invalid field name (reserved): ${k}`);\n    } else if (k === \"__tdxRequired\") {\n      schema.required = schema.__tdxRequired;\n      delete schema.__tdxRequired;\n    } else if (k === \"__tdxDefault\") {\n      schema.default = schema.__tdxDefault;\n      delete schema.__tdxDefault;\n    } else if (k === \"__tdxDescription\") {\n      if (forDisplay) {\n        // Include the description if for display\n        schema.description = schema.__tdxDescription;\n      }\n      // Remove this as it's TDX documentation.\n      delete schema.__tdxDescription;\n    } else if (k === \"__tdxType\") {\n      // This is an explicit type specification,  e.g. { __tdxType: [\"string\",\"geographic\",\"address\",\"postcode\"]}\n      if (!v) {\n        errLog(\"unexpected __tdxType value: %j\", v);\n        errList.push(\"missing __tdxType\");\n      } else {\n        // Ensure type is an array.\n        v = [].concat(v);\n        delete schema.__tdxType;\n        // The base type is the first element and should be a valid mongoose type\n        schema.type = v[0].toLowerCase();\n        if (schema.type === \"object\") {\n          schema = {};\n        } else if (schema.type === \"array\") {\n          schema = [];\n        } else {\n          schema.type = validateMongooseType(vocab, schema.type, errList);\n        }\n      }\n    } else if (Array.isArray(v)) {\n      // Array\n      if (v.length > 1) {\n        errList.push(`invalid array type specification for key: ${k}`);\n      } else if (v.length > 0) {\n        if (typeof v[0] === \"string\") {\n          // Array of single type.\n          schema[k] = [{type: validateMongooseType(vocab, v[0], errList)}];\n        } else {\n          // Array of sub-document spec.\n          schema[k] = [schemaToMongoose(vocab, v[0], errList, forDisplay)];\n        }\n      }\n    } else if (typeof v === \"object\") {\n      // Sub-document\n      schema[k] = schemaToMongoose(vocab, v, errList, forDisplay);\n    } else if (typeof v !== \"string\") {\n      // TODO - review\n      // Don't treat this as an error, just ignore.\n      // Seems to be caused be some legacy schema definitions with { default: true, required: true } etc.\n      // errList.push(\"invalid schema definition - unexpected type for key '\" + k + \"': \" + (typeof v));\n      errLog(`invalid schema definition - unexpected type for key '${k}' : ${(typeof v)}`);\n      delete schema[k];\n    } else {\n      schema[k] = {type: validateMongooseType(vocab, v, errList)};\n    }\n  });\n\n  return schema;\n};\n\nconst definitionToMongoose = function(name, tdxSchema) {\n  const uniqueIndex = tdxSchema.uniqueIndex;\n  const indexes = tdxSchema.nonUniqueIndexes;\n\n  // Convert any given indexes to mongodb format\n  //\n  // Because these dynamic schema definitions are stored in mongodb as documents,\n  // we have to store them in a backwards fashion as mongodb does not allow\n  // key names to contain periods. For example, if the index was saved\n  // as { \"address.postcode\": 1 } mongodb would complain about \"address.postcode\".\n  //\n  // So we store indexes (which are likely to contain dots e.g. if indexing\n  // on nested document) in the form:\n  //\n  // { \"asc\": \"my.nested.key\" } or { \"desc\": \"address.postcode\" }\n  //\n  // Here we convert this stored format to mongodb format so the index can be created.\n  //\n  // The 'indexes' parameter should be an array of arrays of index specifiers, e.g.\n  // the following specifies two indexes, one is a compound index on account and order,\n  // the other is an individual index on completedAt:\n  //\n  // [ [ { \"asc\": \"account\" }, { \"asc\": \"order\" } ], [ {\"asc\": \"completedAt\" } ] ]\n  //\n  // this should translate to a single array of objects, e.g.:\n  //\n  // [ { account: 1 , order: 1 }, { completedAt: 1} ]\n  //\n  const nonUniqueIndexes = [];\n  _.forEach(indexes, function(nonUniqueIndex) {\n    if (nonUniqueIndex.length > 0) {\n      nonUniqueIndexes.push(indexToMongoose(nonUniqueIndex));\n    }\n  });\n  log(\"translated non unique indexes for %s from %j to %j\", name, indexes, nonUniqueIndexes);\n\n  // Do the same for the unique index.\n  // Use the 'uniqueIndex' parameter to set the PK of the schema.\n  // Do this rather than use the built-in mongoose specification in order\n  // to support compound indexes, where the order of fields is important.\n  //\n  // See comment above for index format explanation.\n  const primaryIndex = indexToMongoose(uniqueIndex);\n  log(\"translated primary index for %s from %j to %j\", name, uniqueIndex, primaryIndex);\n\n  //\n  // Remove all index information from the schema, as we set the indexes\n  // manually below.\n  //\n  log(\"transforming schema for %s: %j\", tdxSchema.id, tdxSchema.dataSchema);\n  const errList = [];\n  const mongooseSchema = schemaToMongoose(null, tdxSchema.dataSchema, errList, false);\n  if (errList.length) {\n    throw new Error(`invalid mongoose schema: ${errList.join(\",\")}`);\n  }\n\n  log(\"schema transformed to %j\", mongooseSchema);\n\n  return {\n    schema: mongooseSchema,\n    uniqueIndex: primaryIndex,\n    nonUniqueIndexes: nonUniqueIndexes,\n  };\n};\n\nexport default {\n  definitionToMongoose: definitionToMongoose,\n  schemaToMongoose: function(vocab, tdxSchema, errList, forDisplay) {\n    return schemaToMongoose(vocab || [], _.cloneDeep(tdxSchema), errList, forDisplay);\n  },\n  schemaToTDX: function(vocab, mongooseSchema, errList) {\n    return schemaToTDX(vocab || [], _.cloneDeep(mongooseSchema), errList);\n  },\n  indexToMongoose: indexToMongoose,\n  indexToTDX: indexToTDX,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/schema-utils.js","module.exports = __WEBPACK_EXTERNAL_MODULE_9__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shortid\"\n// module id = 9\n// module chunks = 0","/* eslint-disable max-len */\nimport {generate} from \"shortid\";\nimport constants from \"./constants\";\nimport resourceUtils from \"./resource-utils\";\nimport databotUtils from \"./databot-utils\";\nimport schemaUtils from \"./schema-utils\";\nimport flattenJSON from \"./flatten\";\nimport buildDataKey from \"./build-data-key\";\nimport {unique} from \"./short-hash\";\n\nconst isEmailValid = function(address) {\n  // TODO - improve this (use mailgun?)\n  return /^[A-Z0-9'.1234z_%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,4}$/i.test(address);\n};\n\nconst isHostNameValid = function(hostname) {\n  // From http://stackoverflow.com/a/106223\n  return /^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])$/.test(hostname);\n};\n\nconst isDateValid = function(d) {\n  // From http://stackoverflow.com/q/1353684\n  if (Object.prototype.toString.call(d) !== \"[object Date]\")\n    return false;\n  return !isNaN(d.getTime());\n};\n\nconst isNumeric = function(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n};\n\nconst makeTDXAccount = function(email, tdx) {\n  /*\n   * tdx accounts are stored in email/hostname format, e.g. toby.ealden@gmail.com/tdx.nqminds.com\n   */\n  return `${email}/${tdx}`;\n};\n/**\n * TDX accounts are stored in email/hostname format, e.g. toby.ealden@gmail.com/tdx.nqminds.com\n * @param  {string|object} account - the account to split, can be account object or just the username string.\n */\nconst splitTDXAccount = function(account) {\n  if (!account) {\n    return;\n  }\n\n  // Normalise to account username.\n  if (account.username) {\n    account = account.username;\n  }\n  let result;\n  const split = account.toLowerCase().split(\"/\");\n  if (split.length === 2 && isEmailValid(split[0]) && (isHostNameValid(split[1]) || split[1].indexOf(\"localhost:\") === 0)) {\n    result = {\n      email: split[0],\n      tdx: split[1],\n    };\n  }\n\n  return result;\n};\n\n/**\n * TDX resources are stored in resourceId/hostname format, e.g. DhkDI-du/tdx.nqminds.com\n *\n * @param  {object|string} resource - the resource id or object\n * @param  {string} [tdx] - optional tdx id\n */\nconst makeTDXResourceId = function(resource, tdx) {\n  // Can handle resource as string or id.\n  if (typeof resource === \"object\") {\n    resource = resource.id;\n  }\n  if (splitTDXResourceId(resource).tdx) {\n    // The resource id is already fully qualified\n    return resource;\n  } else if (!resource || !tdx) {\n    // Invalid args - throw?\n    throw new Error(\"makeTDXResource: invalid args - must provide resource and tdx\");\n  } else {\n    return `${resource}/${tdx.toLowerCase()}`;\n  }\n};\n\n/**\n * Splits a resource identifier into component parts - local id and tdx id.\n *\n * TDX resources are stored in resourceId/hostname format, e.g. DhkDI-du/tdx.nqminds.com, but they\n * often omit the hostname portion, which indicates a resource local to the current tdx.\n *\n * @param  {string} resourceId\n */\nconst splitTDXResourceId = function(resourceId) {\n  /*\n   */\n  let result;\n  const split = resourceId.split(\"/\");\n  if (split.length === 2) {\n    if (isHostNameValid(split[1]) || split[1].indexOf(\"localhost:\") === 0) {\n      result = {\n        resourceId: split[0],\n        tdx: split[1],\n      };\n    } else {\n      // Hostname invalid - do nothing and return 'undefined'.\n    }\n  } else if (split.length === 1) {\n    // Assume a local resource - leave the tdx component empty\n    result = {\n      resourceId: split[0],\n    };\n  } else {\n    // Invalid number of components - do nothing and return 'undefined'\n  }\n\n  return result;\n};\n\n/**\n * Splits a schema identifier into component parts - schema id and library id.\n *\n * TDX schema ids are stored in schemaId/libraryId format, e.g. mySuperBespokeSchema/DFHJG_Dk, but they\n * often omit the library portion, which indicates a schema from the system library.\n *\n * @param  {string} schemaId\n */\nconst splitTDXSchemaId = function(schemaId) {\n  /*\n   */\n  let result;\n  const split = schemaId.split(\"/\");\n  if (split.length === 2) {\n    result = {\n      id: split[0],\n      libraryId: split[1],\n    };\n  } else if (split.length === 1) {\n    // Assume a local schema - leave the tdx component empty\n    result = {\n      id: split[0],\n      libraryId: constants.schemasResourceId,\n    };\n  } else {\n    // Invalid number of components - do nothing and return 'undefined'\n  }\n\n  return result;\n};\n\nconst padNumber = function(n, width, z) {\n  z = z || \"0\";\n  n = `${n}`;\n  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n};\n\nconst parseFunction = function(funcText) {\n  const funcReg = /function *\\(([^()]*)\\)[ \\n\\t]*{(.*)}/gmi;\n  const match = funcReg.exec(funcText.replace(/\\n/g, \" \"));\n\n  if (match) {\n    return new Function(match[1].split(\",\"), match[2]);\n  }\n\n  return null;\n};\n\nconst parseTDXError = function(err) {\n  let parsed;\n  if (err && err.name === \"TDXApiError\") {\n    try {\n      parsed = JSON.parse(err.message);\n      parsed.failure = JSON.parse(parsed.failure);\n    } catch (parseError) {\n      parsed = null;\n    }\n  }\n\n  if (!parsed) {\n    // Simulate the format of a TDX error.\n    parsed = {\n      from: \"exception\",\n      code: err.code || \"n/a\",\n      failure: {\n        code: err.code || \"n/a\",\n        message: err.message,\n      },\n    };\n  }\n\n  return parsed;\n};\n\n/**\n * Removes camel casing by inserting spaces at word breaks.\n * See https://stackoverflow.com/a/6229124.\n * @param  {string} inp\n */\nconst unCamelCase = function(inp) {\n  return inp\n    // insert a space between lower & upper\n    .replace(/([a-z])([A-Z])/g, \"$1 $2\")\n    // space before last upper in a sequence followed by lower\n    .replace(/\\b([A-Z]+)([A-Z])([a-z])/, \"$1 $2$3\")\n    // uppercase the first character\n    .replace(/^./, function(str) {\n      return str.toUpperCase();\n    });\n};\n\n/**\n * Creates a slugified version of the given input, e.g. \"The quick brown fox\" => \"the-quick-brown-fox\".\n * @param  {string} inp\n */\nconst slugify = function(inp) {\n  return inp.toString().trim().toLowerCase().replace(/ /g, \"-\").replace(/([^a-zA-Z0-9\\._-]+)/, \"\");\n};\n\nconst shortId = () => generate();\n\nexport {\n  buildDataKey,\n  constants,\n  databotUtils,\n  flattenJSON,\n  isEmailValid,\n  isDateValid,\n  isHostNameValid,\n  isNumeric,\n  makeTDXAccount,\n  makeTDXResourceId,\n  padNumber,\n  parseFunction,\n  parseTDXError,\n  resourceUtils,\n  schemaUtils,\n  shortId,\n  slugify,\n  splitTDXAccount,\n  splitTDXResourceId,\n  splitTDXSchemaId,\n  unCamelCase,\n  unique as shortHash,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_11__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongo-parse\"\n// module id = 11\n// module chunks = 0"],"sourceRoot":""}